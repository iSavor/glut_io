<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Glut</title>
	<script src="Queue.js"></script>
	<script src="models.js"></script>
	<script src="socket.io.js"></script>
    <script src="phaser.js"></script>
	<script>
		//Both are queues of type msg defined in models.js
		producer = new Queue();
		consumer = new Queue();
		var players = [];
		var signals = {loadComplete: false, over: false};

		setInterval(function(){
		    if (!consumer.isEmpty()) {
                var item = consumer.dequeue();
                consumer_handlers[item.key](item.data);
            }
            if (!producer.isEmpty()) {
                var item = producer.dequeue();
                producer_handlers[item.key](item.data);
            }
        }, 10);

		producer_handlers = {
		    "action": function(key) {
		        socket.emit('action', key);
            }
		};
		consumer_handlers = {
			"update": function(new_players) {
				players = new_players;
				//Brute-force replacing might raise performance issue
			},
            "loadComplete": function(id) {
                signals.loadComplete = true;
                my_id = id;
                console.log("complete");
            },
            "gameOver": function() {
			    signals.over = true;
			    console.log("over");
            },
            "leave": function(id) {
			    sprites[id].destroy();
			    delete sprites[id];
            }
		};

	</script>
    <script src="client.js"></script>
	<script src="game.js"></script>
</head>
<body>
</body>
</html>